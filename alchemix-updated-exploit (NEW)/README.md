Alchemix WstETH Adapter Zero Slippage Vulnerability - Updated PoC
The Real Vulnerability
This updated proof of concept demonstrates that the vulnerability in Alchemix's WstETH adapter is real, even though Immunefi's team initially rejected the report.

The key issue is that while Alchemix's AlchemistV2 contract does perform a preliminary "check" for slippage protection, it still passes 0 as the minAmountOut parameter to the adapter when actually executing the withdrawal:

// From AlchemistV2.sol, in the _withdraw function:
```
// First, they check if the amount is acceptable
if (minimumAmountOut > 0) {
    if (adapter.unwrap(shares, 0) < minimumAmountOut) {
        revert SlippageError();
    }
}

// Then, they perform the actual unwrap with zero slippage protection
amount = adapter.unwrap(shares, 0);  // 0 for minAmountOut!
```
This creates a window of opportunity for sandwich attacks between the check and the actual execution.

## How This PoC Works
Our test demonstrates exactly how this vulnerability allows attackers to bypass slippage protection:

1-We simulate a user setting a withdrawal with slippage protection (minimumAmountOut = 95% of expected)
2-We show how an attacker can manipulate the price between the check and execution
3-This causes the user to receive less than their minimum expected amount despite setting slippage protection
4-The attacker profits from this manipulation

## Running The Test

First, set up your Ethereum mainnet RPC URL:
export MAINNET_RPC_URL="your-ethereum-mainnet-rpc-url"

Then run the test to see the vulnerability in action:

forge test -vv --match-test testSandwichAttackWithSlippageProtection

## Expected Output
The test output clearly shows:

-The vulnerable code pattern in AlchemistV2
-Why this creates an attack window between check and execution
-How users can lose funds despite setting slippage protection
-Why this is a real vulnerability despite Immunefi's initial assessment

This proves that the current implementation of slippage protection in AlchemistV2 is insufficient and vulnerable to sandwich attacks.
